# Google Calendar - описание высоконагруженного сервиса
## Содержание(в будущем)
## 1. Тема и целевая аудитория
[Google Calendar](https://calendar.google.com) - это бесплатный сервис для организации расписания, координации встреч с другими людьми, а также фиксирования и напоминания о важных задачах и событиях.
### MVP функционал
1. Авторизация при помощи аккаунта Google
2. Отображение календаря
3. Добавление новых задач на календарь
4. Изменить информацию о задаче
5. Уведомления о ближайших событиях
6. Добавить гостей к мероприятию(задаче)
7. Просмотр календаря другими пользователями

### Целевая аудитория
* MAU (monthly active users) - ~ 500 млн чел [1]
* Т.к. нет информации по DAU - возьмем средний Sticky Factor(отношение DAU к MAU) = 25% -> DAY ~ 125 млн чел
* Средняя длина сессии - 7:39 [3]
* Количество посещений в месяц - 1.3 млрд чел [3]
* Создается более 1,5 млрд событий в календарях каждый день [6]
* Около 1.1 млрд сайтов используют этот календарь [1]
* 398 тыс. компаний используют Google Calendar [1]
* Для отрослевого рынка - 23,91% [1]
#### Аудитория по странам:
![image](https://github.com/user-attachments/assets/7c879371-d105-4e8f-b5d1-25f3f8fb6405)
#### Демография посещаемости сайта:
![image](https://github.com/user-attachments/assets/f80ba32f-8e70-4cd2-acf9-b362f22409b8)
## 2. Расчет нагрузки
### Продуктовые метрики
* MAU (monthly active users) - ~ 500 млн чел [[1]](https://earthweb.com/blog/google-calendar-users/)
* Т.к. нет информации по DAU - возьмем средний Sticky Factor(отношение DAU к MAU) = 25% -> DAU ~ 125 млн чел
#### Размер хранилища пользователя
Для рассчета размера хранилища необходимо найти вес одного события(задачи) и вес одного календаря\
Событие:\
Для удобства напишу весь данных в табличке. Возьмем среднюю заполненность события, и при учете кодировки UTF-8(от 1 до 4 байт, возьму 3 байта как среднее) получим:
Параметр | Вес
------- | -------
Название события | 128 символов -> 3*128=384 Байт
Описание события | 1024 символа -> 3*1024=3072 Байт
Дата начала события | 8 Байт
Дата конца события | 8 Байт
Дата создания события | 8 Байт
Дата обновления события | 8 Байт
Место проведения события | 8 Байт
Время уведомления | 8 байт
Email приглашенного гостя | 255 Байт (85 символов) (Возьмем количество гостей = 20) -> 20*255=5100 Байт
Создатель события(ссылка) | 8 Байт
Разрешения для гостей | 2 Байт
Календаль события | 8 Байт
Итого | 384 + 3072 + 8 + 8 + 8 + 8 + 8 + 8 + 5100 + 8 + 2 + 8 = 8622 Байт

Итак, в день создается около 50 млрд. событий [[1]](https://earthweb.com/blog/google-calendar-users/). То есть каждый пользователь создает 1.5 млрд/125 млн = 12 событий в день.

Сами события хранятся вечно, удаленные события хранятся 30 дней, приложение синхронизирует события последнего года [[5]](https://www.calendar.com/blog/how-do-you-look-up-past-appointments-in-your-calendar/) -> Хранилище событий на 1 пользователя: 365 * 12 * 8604 = 35,94 Мб

Лимит на созданиее событий = 10000, лимит на создание календарей = 25 [[4]](https://classroom.synonym.com/google-calendar-limits-17378.html)

Календарь:
Параметр | Вес
------ | ------
Название календаря | 128 символов -> 3*128=384 Байт
Описание календаря | 1024 символов -> 3*1024=3072 Байт
Дата создания календаря | 8 Байт
Дата обновления календаря | 8 Байт
Создатель календаря(ссылка) | 8 Байт
Часовой пояс календаря | 8 Байт
Итого | 384 + 3072 + 8 + 8 + 8 + 8 = 3488 Байт

Возьмем лимит на создание календарей(25 штук) и посчитаем размер хранилиша для календарей: 25 * 3488 = 85,15 Кб

Итак, средний размер хранилища пользователя равен(возьмем данные пользователя за 1Кб): 35,94 Мб + 85,15 Кб + 1 Кб = 36,03 Мб

Итог по продуктовым метрикам:
Параметр | Значение
------ | ------
Месячная аудитория | 500 млн. человек
Дневная аудитория | 125 млн. человек
Средний размер хранилища пользователя | 1,17 Гб
Добавление событий | 12 запросов/день
Получение напоминаний о событияъ | 12 запросов/день

### Технические метрики
#### Размер хранения в разбивке по типам данных
Число пользователей в месяц = 500 млн. человек -> можем посчитать размер хранения данных

Для событий: 35,94 Мб * 500 млн. = 16,7 Пб

Для календарей: 85,15 Кб * 500 млн = 39,65 Тб

#### Сетевой трафик:
Посчитаем сетевой трафик при просмотре каледаря, создании события, приглашении гостя (возьмем по 2 приглашенныйх гостя), ответ гостя на приглашение, получение напоминания:
* Просмотр календаря: 25 запросов в день -> 25 * 3488 Байт = 85,15 Кб
* Создание события: 12 запросов в день -> 12 * 8604 Байт = 100,82 Кб
* Приглашение гостя: 12 запросов в день (приглашение = 1Кб) -> 12 * 2 * 1 Кб = 24 Кб
* Ответ гостя: 24 запросов в день -> 24 * 1 Кб = 24 Кб
* Получение напоминания: 12 запросов в день -> 12 * 1 Кб = 12 Кб

Потребление трафика:
Возьмем, что пиковое значение превышает среднее в 2 раза
Тип трафика | Данные | Пиковое в Гбит/c | Суммарный суточной Гб/cутки
------ | ------ | ----- | -----
Просмотр календаря | 125 млн * 85,15 Кб = 81 205,6 Гбит | 1,88 | 422,94
Создание события | 125 млн * 100,82 Кб = 96 149,4 Гбит | 2,22 | 500,77
Приглашение гостя | 125 млн * 24 Кб = 22 888,2 | 0,52 | 119,2
Ответ гостя | 125 млн * 24 Кб = 22 888,2 | 0,52 | 119,2
Получение напоминания | 125 млн * 12 Кб = 11 444,1 | 0,26 | 59,6
Итого | 234 575,5 Гбит | 5,4 | 1 301,71

#### RPS
Возьмем, что пиковое значение превышает среднее в 2 раза
Тип трафика | RPS(средний) | Пиковый RPS  | 
------ | ------ | -----
Просмотр календаря | 125 млн * 25 / (24 * 60 * 60) = 36 169 | 72 338
Создание события | 125 млн * 12 / (24 * 60 * 60) = 17 362 | 34 724
Приглашение гостя | 125 млн * 12 / (24 * 60 * 60) = 17 362 | 34 724
Ответ гостя | 125 млн * 12 / (24 * 60 * 60) = 17 362 | 34 724
Получение напоминания | 125 млн * 12 / (24 * 60 * 60) = 17 362 | 34 724
Итого | 105 617 | 211 234

### Список литературы
1. https://earthweb.com/blog/google-calendar-users/
2. https://www.sostav.ru/education/technologies/mail-ru-group-klyuchevye-metriki-dlya-mobilny-175.html
3. https://www.similarweb.com/ru/website/calendar.google.com/#overview
4. https://classroom.synonym.com/google-calendar-limits-17378.html
5. https://www.calendar.com/blog/how-do-you-look-up-past-appointments-in-your-calendar/
6. https://web.archive.org/web/20240811062050/https://marketsplash.com/google-workspace-statistics/
